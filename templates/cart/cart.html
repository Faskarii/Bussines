{% extends 'base.html' %}

{% block title %}سبد خرید{% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">سبد خرید</h2>
            <div id="cart-items">
                <!-- Cart items will be loaded dynamically -->
            </div>
            <div class="text-center mt-4" id="empty-cart-message">
                <p class="text-muted">سبد خرید شما خالی است.</p>
                <a href="{% url 'courses:home' %}" class="btn btn-primary">مشاهده دوره‌ها</a>
            </div>
        </div>
    </div>
</div>

{% block script %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const cart = JSON.parse(localStorage.getItem('cart')) || {};
    const cartItemsContainer = document.getElementById('cart-items');
    const emptyCartMessage = document.getElementById('empty-cart-message');
    
    if (Object.keys(cart).length > 0) {
        emptyCartMessage.style.display = 'none';
        let totalAmount = 0;
        
        for (const [courseId, course] of Object.entries(cart)) {
            totalAmount += parseFloat(course.price);
            const itemHtml = `
                <div class="card mb-3" id="cart-item-${courseId}">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="card-title">${course.name}</h5>
                                <p class="card-text text-primary">${course.price} تومان</p>
                            </div>
                            <button class="btn btn-danger btn-sm" onclick="removeFromCart(${courseId})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            cartItemsContainer.innerHTML += itemHtml;
        }
        
        // Add total and checkout button
        cartItemsContainer.innerHTML += `
            <div class="card mt-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">جمع کل:</h5>
                        <h5 class="mb-0 text-primary">${totalAmount} تومان</h5>
                    </div>
                    <button class="btn btn-success w-100 mt-3" onclick="checkout()">
                        تکمیل خرید
                    </button>
                </div>
            </div>
        `;
    }
});

function removeFromCart(courseId) {
    const cart = JSON.parse(localStorage.getItem('cart')) || {};
    delete cart[courseId];
    localStorage.setItem('cart', JSON.stringify(cart));
    document.getElementById(`cart-item-${courseId}`).remove();
    
    if (Object.keys(cart).length === 0) {
        document.getElementById('empty-cart-message').style.display = 'block';
        document.getElementById('cart-items').innerHTML = '';
    }
    
    // Update cart count in navbar
    document.getElementById("cart").innerHTML = "سبد خرید (" + convertToFarsiNumber(Object.keys(cart).length) + ")";
}

function checkout() {
    // Implement checkout functionality
    alert('در حال انتقال به درگاه پرداخت...');
}
</script>
{% endblock %}
{% endblock %} 